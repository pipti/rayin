/**
 * Version: 5.1.5 (2020-06-26)
 */
(function (domGlobals) {
  'use strict';

  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');
  var openDialog = function (editor) {
    let selection = domGlobals.getSelection()
    return editor.windowManager.open({
      title: '插入div控件',
      body: {
        type: 'panel',
        items: [
          {
            type: 'grid',
            columns: 2,
            items: [{
                type: 'input',
                name: 'Xmark',
                label: 'X：',
                disabled: false
              },
              {
                type: 'input',
                name: 'Ymark',
                label: 'Y:',
                disabled: false
              },
            ] // array of panel components
          },
          {
            type: 'grid',
            columns: 2,
            items: [{
                type: 'selectbox',
                name: 'inputType',
                disabled: false,
                label: '值类型',
                items: [{
                    text: '值',
                    value: 'value'
                  },
                  {
                    text: '变量',
                    value: 'data-th-value'
                  },
                ],
              },
              {
                type: 'selectbox',
                name: 'keyType',
                disabled: true,
                label: '键类型',
                items: [{
                    text: '变量',
                    value: 'value'
                  },
                  {
                    text: '集合',
                    value: 'data-th-value'
                  },
                ],
              },
            ]
          },
          {
            type: 'input',
            name: 'value',
            label: '值/变量',
          }

        ]
      },
      buttons: [{
          type: 'cancel',
          text: 'Close'
        },
        {
          type: 'submit',
          text: 'Save',
          primary: true
        }
      ],
      onChange: function (dialogApi, details) {
        var data = dialogApi.getData();
        if (data.inputType === 'data-th-value') dialogApi.enable("keyType")
        if (data.inputType === 'value') dialogApi.disable("keyType")
      },
      onSubmit: function (api) {
        var data = api.getData();
        var dataValue = "";
        if(data.value){
          if (data.inputType === 'data-th-value') {
            dataValue= "${"+data.value+"}"
          }else{
            dataValue= data.value
          }
          editor.execCommand('mceInsertContent', false,`
            <div ${data.inputType}="${dataValue}"
            style="display:inline-block; position: absolute; right: ${data.Xmark ? data.Xmark : '15'}px; bottom: ${data.Ymark ? data.Ymark : '15'}px;">${dataValue}</div>`);
          api.close();
        }else{
          domGlobals.alert("值/变量不为空");
        }
      }
    });
  };


  var register = function (editor) {
    editor.addCommand('absdiv', function () {
      openDialog(editor)
    });
  };
  var Commands = {
    register: register
  };





  var register$1 = function (editor) {

    editor.ui.registry.getAll().icons.mark || editor.ui.registry.addIcon('absdiv', '<svg t="1612748135111" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2142" width="24" height="24"><path d="M405.078471 616.76576v-26.859952h-0.537199a53.87194 53.87194 0 0 1-21.376467 22.298828 62.558347 62.558347 0 0 1-31.938002 8.220158q-27.255249 0-44.496297-19.916907t-17.230912-55.047696q0-35.68826 18.842509-57.865457t48.905383-22.177197q33.144166 0 47.303922 27.255248h0.537199v-94.658522h13.359024v218.751497z m0-89.935225q0-20.5656-13.034678-34.938209t-35.069974-14.372607q-23.261731 0-38.424934 17.839061t-15.203746 48.976334q0 30.600073 13.632692 47.232971t35.140925 16.643034q25.25849 0 39.083763-15.639587t13.835409-38.212082z" p-id="2143"></path><path d="M351.226803 633.074311c-21.933937 0-40.127753-8.179615-54.084792-24.325993-13.480655-15.578772-20.32234-36.884288-20.322341-63.338806 0-26.768729 7.348477-48.996605 21.852851-66.065344 15.021301-17.687024 34.725356-26.687642 58.564829-26.687642 13.460383 0 25.268626 2.99007 35.171333 8.808037v-76.120088h38.739144v244.091073h-38.739144v-8.108665q-1.40888 0.912225-2.888712 1.763635a75.248407 75.248407 0 0 1-38.293168 9.983793z m5.747016-142.915212c-11.706884 0-21.112935 4.378679-28.765488 13.379297-8.108664 9.477002-12.162997 23.200916-12.162996 40.766311 0 17.301863 3.618492 30.498714 10.764252 39.205392 6.699784 8.189751 14.757769 12.000823 25.339576 12.000824 13.17658 0 22.836026-3.71985 29.596626-11.362266 7.166032-8.108664 10.652758-17.859334 10.652758-29.819614v-27.498508c0-10.5514-3.192787-19.197263-9.750669-26.434247-6.233536-6.861957-14.615868-10.237189-25.674059-10.237189zM527.022649 431.685492a10.936561 10.936561 0 0 1-10.956833-11.220364 9.862163 9.862163 0 0 1 3.344824-7.68296 11.03792 11.03792 0 0 1 7.612009-3.040749 11.777835 11.777835 0 0 1 7.814725 2.878576 9.689854 9.689854 0 0 1 3.40564 7.814725 10.713573 10.713573 0 0 1-3.334689 7.946492 10.86561 10.86561 0 0 1-7.885676 3.30428z m-6.547747 185.080268V468.975213h13.17658v147.790547z" p-id="2144"></path><path d="M546.37195 629.435548h-38.516157V456.305425h38.516157z m-19.349301-185.080267a23.616485 23.616485 0 0 1-23.626621-23.890153 22.410322 22.410322 0 0 1 7.541058-17.109282 23.748251 23.748251 0 0 1 16.085563-6.253808 24.52871 24.52871 0 0 1 15.984205 5.888918 22.471136 22.471136 0 0 1 7.905948 17.504579 23.950968 23.950968 0 0 1-23.890153 23.890153z m0-25.339577a2.027166 2.027166 0 0 0-1.013583 0.375026 2.300834 2.300834 0 0 0-0.435841 1.074398 3.436047 3.436047 0 0 0 1.09467 1.864993 1.09467 1.09467 0 0 0 0.385162 0.111494 1.925808 1.925808 0 0 0 0.881817-0.283803 3.162379 3.162379 0 0 0 0.80073-1.631869 2.544093 2.544093 0 0 0-0.628421-1.125077 2.158932 2.158932 0 0 0-1.084534-0.385162z m1.712955 1.571054zM684.381419 616.76576h-12.162996l-57.054591-147.790547h14.82872l43.969234 117.575636a96.979627 96.979627 0 0 1 4.500308 15.50782h0.537199a92.144836 92.144836 0 0 1 4.135419-14.82872l45.611238-118.254736h14.433423z" p-id="2145"></path><path d="M692.976604 629.435548h-29.444588L596.696349 456.305425h42.094104l40.01626 107.044507 41.242694-107.044507h41.810302l-68.883105 173.130123z" p-id="2146"></path><path d="M71.873175 122.005459a50.821055 50.821055 0 0 1 13.835409-34.887529v-0.172309h0.162173a50.932549 50.932549 0 0 1 74.103058 0h79.80953A122.004993 122.004993 0 1 0 85.71872 238.202622v-81.299498a50.851462 50.851462 0 0 1-13.845545-34.897665zM902.463951 70.961416a51.013636 51.013636 0 0 1 33.083351 89.884546v78.603367A122.004993 122.004993 0 1 0 785.60796 86.945621h79.80953A50.902141 50.902141 0 0 1 902.463951 70.961416zM935.547302 784.534028v78.623638a51.023771 51.023771 0 1 1-70.383208 73.646946h-79.627085a122.004993 122.004993 0 1 0 150.010293-152.250312z" p-id="2147"></path><path d="M239.580628 157.896436h-80.387272c-0.810866 0.821002-1.662276 1.621733-2.533958 2.38192v78.988528a122.521921 122.521921 0 0 0 82.92123-81.370448zM864.596488 237.989769v-80.073062h-78.694589a122.562464 122.562464 0 0 0 78.694589 80.073062zM785.901899 865.833526h78.664181v-79.829802a122.552328 122.552328 0 0 0-78.664181 79.829802z" p-id="2148"></path><path d="M156.659398 783.469766v79.535863c1.013583 0.912225 1.915672 1.844721 2.817761 2.827897h79.515591a122.532056 122.532056 0 0 0-82.333352-82.36376z" p-id="2149"></path><path d="M122.004993 951.501566a50.88187 50.88187 0 0 1-35.809889-14.717226h-0.476384v-0.476384a50.952821 50.952821 0 0 1 0-71.721138v-80.630532a122.004993 122.004993 0 1 0 152.757103 152.828054H157.814883a50.88187 50.88187 0 0 1-35.80989 14.717226z" p-id="2150"></path><path d="M785.901899 865.833526H238.99275a122.20771 122.20771 0 0 1-0.516927 70.950814h547.061186a122.177302 122.177302 0 0 1 0.395297-70.950814zM156.659398 783.469766V239.266884a122.227981 122.227981 0 0 1-70.950814-1.064262v545.753664a122.08608 122.08608 0 0 1 70.950814-0.48652zM239.580628 157.896436h546.321271a122.268525 122.268525 0 0 1-0.24326-70.950815H239.783345a122.268525 122.268525 0 0 1-0.24326 70.950815zM864.596488 237.989769v548.013955a122.065808 122.065808 0 0 1 70.950814-1.469696V239.449329a122.177302 122.177302 0 0 1-70.950814-1.45956z" p-id="2151"></path><path d="M173.971397 122.005459a50.902141 50.902141 0 0 1-14.778041 35.890977h80.387272a122.268525 122.268525 0 0 0 0.24326-70.950815h-79.850073a50.841326 50.841326 0 0 1 13.997582 35.059838zM85.708584 86.945621v0.172309l0.162173-0.172309zM156.659398 239.266884v-78.988528a50.922413 50.922413 0 0 1-70.950814-3.375232V238.202622a122.227981 122.227981 0 0 0 70.950814 1.064262zM785.901899 157.896436h78.745268v80.073062a122.177302 122.177302 0 0 0 70.950814 1.459559v-78.583095a51.013636 51.013636 0 0 1-70.129812-73.900341h-79.860209a122.268525 122.268525 0 0 0 0.24326 70.950815zM851.419908 901.977898a51.013636 51.013636 0 0 1 84.127394-38.840503v-78.603367a122.065808 122.065808 0 0 0-70.950814 1.469696v79.829802h-78.694589a122.177302 122.177302 0 0 0-0.395297 70.950814h79.657492a50.88187 50.88187 0 0 1-13.744186-34.806442zM122.004993 849.393208a50.902141 50.902141 0 0 1 34.664541 13.612421v-79.535863a122.08608 122.08608 0 0 0-70.950814 0.48652v80.630532a50.851462 50.851462 0 0 1 36.286273-15.19361zM85.708584 936.78434h0.476384c-0.162173-0.162173-0.324347-0.314211-0.476384-0.476384zM238.99275 865.833526h-79.485183a50.942685 50.942685 0 0 1-1.662277 70.950814h80.66094a122.20771 122.20771 0 0 0 0.516928-70.950814z" p-id="2152"></path></svg>');
    editor.ui.registry.addButton('absdiv', {
      icon: 'absdiv',
      tooltip: 'absdiv',
      onAction: function () {
        return openDialog(editor)
      }
    });
    editor.ui.registry.addMenuItem('absdiv', {
      icon: 'absdiv',
      text: 'absdiv',
      onAction: function () {
        return openDialog(editor)
      }
    });
  };
  var Buttons = {
    register: register$1
  };

  function Plugin() {
    global.add('absdiv', function (editor) {
      Commands.register(editor);
      Buttons.register(editor);
    });
  }

  Plugin();

}(window));