(function(){var a=tinymce.util.Tools.resolve("tinymce.PluginManager");var Z=function(){};var H=function(ad){return function(){return ad}};function o(ad){var af=[];for(var ae=1;ae<arguments.length;ae++){af[ae-1]=arguments[ae]}return function(){var ag=[];for(var ai=0;ai<arguments.length;ai++){ag[ai]=arguments[ai]}var ah=af.concat(ag);return ad.apply(null,ah)}}var D=H(false);var x=H(true);var V=tinymce.util.Tools.resolve("tinymce.util.Tools");var U=tinymce.util.Tools.resolve("tinymce.util.XHR");var J=function(ad){return ad.getParam("template_cdate_classes","cdate")};var R=function(ad){return ad.getParam("template_mdate_classes","mdate")};var ac=function(ad){return ad.getParam("template_selected_content_classes","selcontent")};var T=function(ad){return ad.getParam("template_preview_replace_values")};var b=function(ad){return ad.getParam("template_replace_values")};var e=function(ad){return ad.templates};var g=function(ad){return ad.getParam("template_cdate_format",ad.translate("%Y-%m-%d"))};var C=function(ad){return ad.getParam("template_mdate_format",ad.translate("%Y-%m-%d"))};var u={getCreationDateClasses:J,getModificationDateClasses:R,getSelectedContentClasses:ac,getPreviewReplaceValues:T,getTemplateReplaceValues:b,getTemplates:e,getCdateFormat:g,getMdateFormat:C};var K=function(af,ad){af=""+af;if(af.length<ad){for(var ae=0;ae<ad-af.length;ae++){af="0"+af}}return af};var W=function(ai,ae,ag){var ad="Sun Mon Tue Wed Thu Fri Sat Sun".split(" ");var aj="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ");var ah="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");var af="January February March April May June July August September October November December".split(" ");ag=ag||new Date();ae=ae.replace("%D","%m/%d/%Y");ae=ae.replace("%r","%I:%M:%S %p");ae=ae.replace("%Y",""+ag.getFullYear());ae=ae.replace("%y",""+ag.getYear());ae=ae.replace("%m",K(ag.getMonth()+1,2));ae=ae.replace("%d",K(ag.getDate(),2));ae=ae.replace("%H",""+K(ag.getHours(),2));ae=ae.replace("%M",""+K(ag.getMinutes(),2));ae=ae.replace("%S",""+K(ag.getSeconds(),2));ae=ae.replace("%I",""+((ag.getHours()+11)%12+1));ae=ae.replace("%p",""+(ag.getHours()<12?"AM":"PM"));ae=ae.replace("%B",""+ai.translate(af[ag.getMonth()]));ae=ae.replace("%b",""+ai.translate(ah[ag.getMonth()]));ae=ae.replace("%A",""+ai.translate(aj[ag.getDay()]));ae=ae.replace("%a",""+ai.translate(ad[ag.getDay()]));ae=ae.replace("%%","%");return ae};var X={getDateTime:W};var aa=function(ad,ae){return function(){var af=u.getTemplates(ad);if(typeof af==="function"){af(ae);return}if(typeof af==="string"){U.send({url:af,success:function(ag){ae(JSON.parse(ag))}})}else{ae(af)}}};var c=function(ad,ae){V.each(ae,function(ag,af){if(typeof ag==="function"){ag=ag(af)}ad=ad.replace(new RegExp("\\{\\$"+af+"\\}","g"),ag)});return ad};var n=function(ad,af){var ag=ad.dom,ae=u.getTemplateReplaceValues(ad);V.each(ag.select("*",af),function(ah){V.each(ae,function(aj,ai){if(ag.hasClass(ah,ai)){if(typeof ae[ai]==="function"){ae[ai](ah)}}})})};var Q=function(ae,ad){return new RegExp("\\b"+ad+"\\b","g").test(ae.className)};var B=function(af,ah,ad){var ae;var aj;var ai=af.dom;var ag=af.selection.getContent();ad=c(ad,u.getTemplateReplaceValues(af));ae=ai.create("div",null,ad);aj=ai.select(".mceTmpl",ae);if(aj&&aj.length>0){ae=ai.create("div",null);ae.appendChild(aj[0].cloneNode(true))}V.each(ai.select("*",ae),function(ak){if(Q(ak,u.getCreationDateClasses(af).replace(/\s+/g,"|"))){ak.innerHTML=X.getDateTime(af,u.getCdateFormat(af))}if(Q(ak,u.getModificationDateClasses(af).replace(/\s+/g,"|"))){ak.innerHTML=X.getDateTime(af,u.getMdateFormat(af))}if(Q(ak,u.getSelectedContentClasses(af).replace(/\s+/g,"|"))){ak.innerHTML=ag}});n(af,ae);af.execCommand("mceInsertContent",false,ae.innerHTML);af.addVisual()};var w={createTemplateList:aa,replaceTemplateValues:c,replaceVals:n,insertTemplate:B};var m=function(ad){ad.addCommand("mceInsertTemplate",o(w.insertTemplate,ad))};var i={register:m};var j=function(ad){ad.on("PreProcess",function(ag){var af=ad.dom,ae=u.getMdateFormat(ad);V.each(af.select("div",ag.node),function(ah){if(af.hasClass(ah,"mceTmpl")){V.each(af.select("*",ah),function(ai){if(af.hasClass(ai,ad.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))){ai.innerHTML=X.getDateTime(ad,ae)}});w.replaceVals(ad,ah)}})})};var ab={setup:j};var t=function(){return L};var L=function(){var ad=function(ah){return ah.isNone()};var ae=function(ah){return ah()};var ag=function(ah){return ah};var af={fold:function(ai,ah){return ai()},is:D,isSome:D,isNone:x,getOr:ag,getOrThunk:ae,getOrDie:function(ah){throw new Error(ah||"error: getOrDie called on none.")},getOrNull:H(null),getOrUndefined:H(undefined),or:ag,orThunk:ae,map:t,each:Z,bind:t,exists:D,forall:x,filter:t,equals:ad,equals_:ad,toArray:function(){return[]},toString:H("none()")};if(Object.freeze){Object.freeze(af)}return af}();var N=function(ad){var ah=H(ad);var ae=function(){return af};var ag=function(ai){return ai(ad)};var af={fold:function(aj,ai){return ai(ad)},is:function(ai){return ad===ai},isSome:x,isNone:D,getOr:ah,getOrThunk:ah,getOrDie:ah,getOrNull:ah,getOrUndefined:ah,or:ae,orThunk:ae,map:function(ai){return N(ai(ad))},each:function(ai){ai(ad)},bind:ag,exists:ag,forall:ag,filter:function(ai){return ai(ad)?af:L},toArray:function(){return[ad]},toString:function(){return"some("+ad+")"},equals:function(ai){return ai.is(ad)},equals_:function(aj,ai){return aj.fold(D,function(ak){return ai(ad,ak)})}};return af};var p=function(ad){return ad===null||ad===undefined?L:N(ad)};var l={some:N,none:t,from:p};var h=function(ad){if(ad===null){return"null"}var ae=typeof ad;if(ae==="object"&&(Array.prototype.isPrototypeOf(ad)||ad.constructor&&ad.constructor.name==="Array")){return"array"}if(ae==="object"&&(String.prototype.isPrototypeOf(ad)||ad.constructor&&ad.constructor.name==="String")){return"string"}return ae};var G=function(ad){return function(ae){return h(ae)===ad}};var r=G("function");var q=Array.prototype.slice;var F=function(af,ai){var ae=af.length;var ah=new Array(ae);for(var ag=0;ag<ae;ag++){var ad=af[ag];ah[ag]=ai(ad,ag)}return ah};var P=function(ag,af){for(var ah=0,ae=ag.length;ah<ae;ah++){var ad=ag[ah];if(af(ad,ah)){return l.some(ad)}}return l.none()};var f=r(Array.from)?Array.from:function(ad){return q.call(ad)};var S=tinymce.util.Tools.resolve("tinymce.util.Promise");var k=Object.hasOwnProperty;var Y=function(ae,ad){return d(ae,ad)?l.from(ae[ad]):l.none()};var d=function(ae,ad){return k.call(ae,ad)};var z={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"};var O=function(ad){return ad.replace(/["'<>&]/g,function(ae){return Y(z,ae).getOr(ae)})};var M=function(ah,ag){if(ag.indexOf("<html>")===-1){var af="";V.each(ah.contentCSS,function(ak){af+='<link type="text/css" rel="stylesheet" href="'+ah.documentBaseURI.toAbsolute(ak)+'">'});var ae=ah.settings.body_class||"";if(ae.indexOf("=")!==-1){ae=ah.getParam("body_class","","hash");ae=ae[ah.id]||""}var ai=ah.dom.encode;var aj=ah.getBody().dir;var ad=aj?' dir="'+ai(aj)+'"':"";ag="<!DOCTYPE html><html><head>"+af+'</head><body class="'+ai(ae)+'"'+ad+">"+ag+"</body></html>"}return w.replaceTemplateValues(ag,u.getPreviewReplaceValues(ah))};var A=function(ai,ag){var af=function(){if(!ag||ag.length===0){var an=ai.translate("No templates defined.");ai.notificationManager.open({text:an,type:"info"});return l.none()}return l.from(V.map(ag,function(aq,ap){var ao=function(ar){return ar.url!==undefined};return{selected:ap===0,text:aq.title,value:{url:ao(aq)?l.from(aq.url):l.none(),content:!ao(aq)?l.from(aq.content):l.none(),description:aq.description}}}))};var ak=function(an){return F(an,function(ao){return{text:ao.text,value:ao.text}})};var am=function(ao,an){return P(ao,function(ap){return ap.text===an})};var ae=function(an){return new S(function(ap,ao){an.value.url.fold(function(){return ap(an.value.content.getOr(""))},function(aq){return U.send({url:aq,success:function(ar){ap(ar)},error:function(ar){ao(ar)}})})})};var aj=function(ao,an){return function(ap,ar){if(ar.name==="template"){var aq=ap.getData().template;am(ao,aq).each(function(at){ap.block("Loading...");ae(at).then(function(au){an(ap,at,au);ap.unblock()})})}}};var ah=function(an){return function(ao){var ap=ao.getData();am(an,ap.template).each(function(aq){ae(aq).then(function(ar){w.insertTemplate(ai,false,ar);ao.close()})})}};var ad=function(ar){var aq=ak(ar);var ao=function(au,at){return{title:"Insert Template",size:"large",body:{type:"panel",items:au},initialData:at,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:true}],onSubmit:ah(ar),onChange:aj(ar,ap)}};var ap=function(av,aw,au){var ax=M(ai,au);var ay=[{type:"selectbox",name:"template",label:"Templates",items:aq},{type:"htmlpanel",html:'<p aria-live="polite">'+O(aw.value.description)+"</p>"},{label:"Preview",type:"iframe",name:"preview",sandboxed:false}];var at={template:aw.text,preview:ax};av.unblock();av.redial(ao(ay,at));av.focus("template")};var an=ai.windowManager.open(ao([],{template:"",preview:""}));an.block("Loading...");ae(ar[0]).then(function(at){ap(an,ar[0],at)})};var al=af();al.each(ad)};var s={open:A};var E=function(ad){return function(ae){s.open(ad,ae)}};var I=function(ad){ad.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction:w.createTemplateList(ad.settings,E(ad))});ad.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction:w.createTemplateList(ad.settings,E(ad))})};var y={register:I};function v(){a.add("template",function(ad){y.register(ad);i.register(ad);ab.setup(ad)})}v()}());