(function(){var b=tinymce.util.Tools.resolve("tinymce.PluginManager");function a(){b.add("ruler",function(d){var c;var e;function f(){console.log("ddd");try{c=$(d.getDoc().getElementsByTagName("HTML")[0]);console.log($("tinystyle").html());c.find("head").append($("<style>"+$("tinystyle").html()+"</style>"))}catch(q){console.log(q)}var l=96;var t=l/2.54;var u=t*(29.7-5.7);var p=4;var m=c.height()+u*5;var x=14;var h=[];c.find(".mce-pagebreak").each(function(){h[h.length]=$(this).offset().top});h.sort();if(e===h){return}e=h;console.log("Redraw ruler");var w="";w+='<svg width="100%" height="'+m+'" xmlns="http://www.w3.org/2000/svg">';w+="<style>";w+=".pageNumber{font-weight:bold;font-size:19px;font-family:verdana;text-shadow:1px 1px 1px rgba(0,0,0,.6);}";w+="</style>";var k=Math.ceil(m/u);var o,n,g=p;for(o=0;o<k;o++){var v=u;var r=0;for(var n=0;n<h.length;n++){if(h[n]<g+v){v=h[n]-g;r=1;h.splice(n,1)}}w+='<line x1="0" y1="'+g+'" x2="100%" y2="'+g+'" stroke-width="1" stroke="red"/>';w+='<pattern id="ruler'+o+'" x="0" y="'+g+'" width="37.79527559055118" height="37.79527559055118" patternUnits="userSpaceOnUse">';w+='<line x1="0" y1="0" x2="100%" y2="0" stroke-width="1" stroke="black"/>';w+="</pattern>";w+='<rect x="0" y="'+g+'" width="100%" height="'+v+'" fill="url(#ruler'+o+')" />';w+='<text x="10" y="'+(g+19+5)+'" class="pageNumber" fill="#ffffff">'+(o+1)+".</text>";g+=v;if(r){g+=x}}w+="</svg>";c.css("background-image",'url("data:image/svg+xml;utf8,'+encodeURIComponent(w)+'")')}d.on("NodeChange",f);d.on("init",f)})}a()}());